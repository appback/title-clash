# title-clash PDCA 계획서 (Plan Document)

> 작성일: 2026-02-11
> 프로젝트: title-clash — AI 제목 대결 플랫폼
> 단계: Plan (계획)

---

## 1. 프로젝트 개요

### 1.1 비전
여러 AI 에이전트가 이미지를 보고 창의적인 "제목"을 생성하고, 휴먼 사용자가 투표하여 우승 AI에 보상을 제공하는 콘테스트 플랫폼.

### 1.2 핵심 가치
- **공정성**: 투표 무결성과 중복 방지를 통한 신뢰 확보
- **확장성**: 높은 동시접속에도 안정적인 투표·집계 처리
- **개방성**: 에이전트와 운영자가 쉽게 통합할 수 있는 API

---

## 2. 현재 상태 분석 (As-Is)

### 2.1 구현 완료 항목

| 영역 | 상태 | 설명 |
|------|------|------|
| API 스켈레톤 | ✅ 완료 | Express.js 기반 titles, matches, votes 엔드포인트 |
| PostgreSQL 통합 | ✅ 완료 | 4개 테이블 (users, titles, matches, votes) + 마이그레이션 |
| React SPA | ✅ 완료 | 3개 페이지 (홈, 제출, 투표) |
| Docker 설정 | ✅ 완료 | docker-compose (로컬 + AWS 오버라이드) |
| CI/CD | ✅ 완료 | GitHub Actions 워크플로우 |
| 배포 자동화 | ✅ 완료 | EC2 배포 스크립트 + systemd 서비스 |
| 모델 라우팅 | ✅ 완료 | TypeScript 미들웨어 (비용 제어) |
| 문서화 | ✅ 완료 | Architecture, API Spec, Security, Rewards, Operations |

### 2.2 미구현 / 개선 필요 항목

| 영역 | 상태 | 우선순위 | 설명 |
|------|------|----------|------|
| 설계-구현 갭 | ⚠️ 불일치 | **높음** | Architecture 문서의 v1 API(problems/submissions) vs 현재 구현(titles/matches) 불일치 |
| 이미지 업로드 | ❌ 미구현 | **높음** | S3 스토리지 연동 없음 — 핵심 기능(이미지 보고 제목 생성) |
| 에이전트 인증 | ❌ 미구현 | **높음** | API 토큰 발급/검증 시스템 없음 |
| 라운드 시스템 | ❌ 미구현 | **높음** | 문제(Problem) 생성/시작/종료 라이프사이클 없음 |
| 보상 로직 | ❌ 미구현 | 중간 | rewards 테이블 및 포인트 분배 로직 |
| 통계 API | ⚠️ 미완성 | 중간 | `/api/stats/top`이 빈 배열 반환 |
| 실시간 기능 | ❌ 미구현 | 낮음 | WebSocket/SSE 실시간 투표 현황 |
| 관리자 대시보드 | ❌ 미구현 | 낮음 | 문제 업로드, 라운드 관리, 부정행위 로그 |
| UI/UX 개선 | ⚠️ 기초 수준 | 중간 | 기본 CSS만 적용, 디자인 시스템 없음 |
| 테스트 코드 | ❌ 미구현 | 중간 | 유닛/통합 테스트 없음 |

### 2.3 스키마 갭 분석

**설계 문서 (ARCHITECTURE.md)의 스키마:**
```
problems, submissions, votes, agents, users, rewards
```

**현재 구현된 스키마:**
```
users, titles, matches, votes
```

**누락된 테이블:** `problems`, `submissions`, `agents`, `rewards`
**추가 필요 컬럼:** image_url, agent_id, round 상태 관리 등

---

## 3. 목표 상태 (To-Be)

### 3.1 Phase 1 — 핵심 기능 완성 (MVP+)

> 목표: 실제로 "이미지 → AI 제목 생성 → 투표 → 보상" 흐름이 작동하는 상태

1. **스키마 정규화**: Architecture 문서와 구현 일치시키기
   - `problems` 테이블 추가 (이미지 URL, 라운드 상태)
   - `submissions` 테이블 추가 (agent_id, problem_id, title)
   - `agents` 테이블 추가 (인증 토큰, 메타데이터)
   - `rewards` 테이블 추가 (포인트 지급 내역)
   - 기존 `titles`, `matches` 테이블 마이그레이션 또는 리팩터링

2. **에이전트 인증 시스템**
   - API 토큰 발급 엔드포인트
   - Bearer 토큰 검증 미들웨어
   - 에이전트 등록/관리 API

3. **이미지 업로드 & 서빙**
   - S3 (또는 로컬 스토리지) 연동
   - 이미지 업로드 엔드포인트
   - 썸네일 생성 (선택)

4. **라운드 라이프사이클**
   - 문제(Problem) CRUD
   - 라운드 시작/종료 상태 관리
   - 제출 기간 제한 (start_at ~ end_at)

5. **보상 분배 로직**
   - 라운드 종료 시 자동 집계
   - 상위 N위 포인트 지급
   - 보상 내역 조회 API

### 3.2 Phase 2 — 품질 & 안정성

6. **API v1 정규화**
   - `/api/v1/` 접두사 통일
   - 에러 코드 체계화 (400, 401, 403, 404, 429, 500)
   - 요청 검증 (입력값 검증, JSON Schema)

7. **테스트 인프라**
   - API 통합 테스트 (Jest 또는 Vitest)
   - DB 마이그레이션 테스트
   - CI에 테스트 단계 추가

8. **보안 강화**
   - Rate limiting (express-rate-limit)
   - CORS 설정
   - 입력 값 새니타이징
   - CAPTCHA 검토

9. **통계 API 완성**
   - 상위 에이전트 순위
   - 라운드별 통계
   - 투표 분석 대시보드 데이터

### 3.3 Phase 3 — UX & 운영

10. **UI/UX 개선**
    - 디자인 시스템 도입 (Tailwind CSS 또는 shadcn/ui)
    - 반응형 레이아웃
    - 투표 UX 개선 (이미지 + 제목 카드형)
    - 결과 발표 페이지

11. **관리자 대시보드**
    - 문제 업로드 UI
    - 라운드 관리 (시작/종료/모니터링)
    - 부정행위 로그 뷰어

12. **실시간 기능**
    - WebSocket/SSE 실시간 투표 현황
    - 라운드 타이머

---

## 4. 기술 스택 확정

| 레이어 | 기술 | 비고 |
|--------|------|------|
| Frontend | React 18 + Vite | 기존 유지 |
| Backend | Node.js + Express | 기존 유지 |
| Database | PostgreSQL 15 | 기존 유지 |
| Cache | Redis | 추가 필요 (실시간 집계, Rate Limit) |
| Storage | AWS S3 | 이미지 저장 |
| Auth | JWT / API Token | 에이전트: API 토큰, 운영자: JWT |
| Test | Vitest | 추가 필요 |
| CSS | Tailwind CSS | 검토 필요 |
| Container | Docker + Compose | 기존 유지 |
| CI/CD | GitHub Actions | 기존 유지 |
| Deploy | AWS EC2 | 기존 유지 |

---

## 5. 구현 우선순위 & 로드맵

### Sprint 1: 스키마 통합 & 에이전트 인증
```
[1] DB 마이그레이션: problems, submissions, agents, rewards 테이블 생성
[2] 에이전트 등록/인증 API
[3] 기존 titles/matches 로직을 problems/submissions로 리팩터링
[4] API v1 라우트 구조 정리
```

### Sprint 2: 이미지 & 라운드 시스템
```
[5] 이미지 업로드 API (S3 연동)
[6] 라운드(문제) CRUD + 라이프사이클
[7] 에이전트 제출 엔드포인트 (기존 titles → submissions)
[8] 투표 흐름을 라운드 기반으로 전환
```

### Sprint 3: 보상 & 통계
```
[9] 라운드 종료 → 집계 → 보상 분배 로직
[10] 통계 API 완성 (상위 에이전트, 라운드 결과)
[11] 보상 내역 조회 API
```

### Sprint 4: 테스트 & 보안
```
[12] API 통합 테스트 작성
[13] Rate limiting, CORS, 입력 검증
[14] CI 테스트 파이프라인 강화
```

### Sprint 5: UI/UX 개선
```
[15] 디자인 시스템 도입
[16] 투표 페이지 리디자인 (이미지 + 카드형)
[17] 결과 페이지, 순위 보드
[18] 관리자 대시보드 (기본)
```

---

## 6. 리스크 & 대응 전략

| 리스크 | 영향 | 대응 |
|--------|------|------|
| 스키마 마이그레이션으로 인한 기존 데이터 손실 | 높음 | 마이그레이션 전 백업 필수, 단계적 마이그레이션 |
| S3 비용 증가 | 중간 | 이미지 크기 제한, 썸네일 자동 생성 |
| 투표 조작 (봇) | 높음 | CAPTCHA, IP 기반 제한, 이상 투표 탐지 |
| 에이전트 과다 요청 | 중간 | Rate limiting, 제출 빈도 제한 |
| 동시 투표 시 데이터 정합성 | 높음 | 트랜잭션 + 행 잠금 (기존 구현 유지) |

---

## 7. 성공 기준 (Definition of Done)

### Phase 1 완료 조건
- [ ] Architecture 문서와 DB 스키마가 일치
- [ ] 에이전트가 토큰으로 인증하여 제목 제출 가능
- [ ] 운영자가 이미지 문제를 등록할 수 있음
- [ ] 라운드 시작 → 에이전트 제출 → 사용자 투표 → 결과 집계 → 보상 분배 전체 흐름 작동
- [ ] 보상 포인트가 rewards 테이블에 기록됨

### Phase 2 완료 조건
- [ ] API 통합 테스트 커버리지 70% 이상
- [ ] Rate limiting 적용
- [ ] 통계 API가 실제 데이터 반환
- [ ] CI에서 테스트 자동 실행

### Phase 3 완료 조건
- [ ] 반응형 UI 적용
- [ ] 관리자가 대시보드에서 라운드 관리 가능
- [ ] 실시간 투표 현황 표시

---

## 8. 의존성 & 전제조건

| 항목 | 상태 | 담당 |
|------|------|------|
| AWS S3 버킷 생성 | 미완료 | 인프라 |
| AWS IAM 정책 설정 | 미완료 | 인프라 |
| Redis 인스턴스 (프로덕션) | 미완료 | 인프라 |
| 도메인/SSL 설정 | 미확인 | 인프라 |
| 에이전트 제공자 온보딩 프로세스 | 미정의 | 기획 |
| 투표 규칙 확정 (단일표/복수표) | 미정의 | 기획 |
| 보상 정책 최종 확정 | 미정의 | 기획 |

---

## 9. 다음 단계 (Next Action)

1. **즉시**: 이 계획서를 기반으로 Sprint 1 상세 설계(Design) 문서 작성
2. **단기**: DB 마이그레이션 스크립트 작성 및 스키마 통합
3. **검토**: 투표 규칙, 보상 정책 등 기획 사항 확정 필요

---

> **PDCA 상태**: Plan ✅ → Design (다음) → Do → Check → Act
>
> 설계 문서 작성을 시작하려면 `/pdca design title-clash`를 실행하세요.
